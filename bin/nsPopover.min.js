/**
 * nsPopover - v0.6.1 - 2015-01-29
 * http://nohros.com/nsPopover
 *
 * Copyright (c) 2015 Neylor Ohmaly
 * Licensed MIT <https://raw.github.com/nohros/nsPopover/master/LICENSE>
 */
!function(a,b,c){"use strict";var d=b.module("nsPopover",[]),e=b.element,f=b.isDefined,g=[],h=0;d.provider("nsPopover",function(){var a={template:"",theme:"ns-popover-list-theme",plain:"false",trigger:"click",triggerPrevent:!0,angularEvent:"",scopeEvent:"",container:"body",placement:"bottom|left",timeout:1.5,hideOnInsideClick:!1,hideOnOutsideClick:!0,hideOnButtonClick:!0,mouseRelative:"",popupDelay:0};this.setDefaults=function(c){b.extend(a,c)},this.$get=function(){return{getDefaults:function(){return a}}}}),d.directive("nsPopover",["nsPopover","$rootScope","$timeout","$templateCache","$q","$http","$compile","$document","$parse",function(d,i,j,k,l,m,n,o,p){return{restrict:"A",scope:!0,link:function(q,r,s){function t(a,b,c,d,e){var f,g,h=v(a[0]),i=function(){return"center"===c?Math.round(d.left+d.width/2-h.width/2):"right"===c?d.right-h.width:d.left},j=function(){return"center"===c?Math.round(d.top+d.height/2-h.height/2):"bottom"===c?d.bottom-h.height:d.top};"top"===b?(f=d.top-h.height,g=i()):"right"===b?(f=j(),g=d.right):"bottom"===b?(f=d.bottom,g=i()):"left"===b&&(f=j(),g=d.left-h.width),a.css("top",f.toString()+"px").css("left",g.toString()+"px"),e&&("top"===b||"bottom"===b?(g=d.left+d.width/2-g,e.css("left",g.toString()+"px")):(f=d.top+d.height/2-f,e.css("top",f.toString()+"px")))}function u(a,b,c,d){var e={bottom:a.bottom,height:a.height,left:a.left,right:a.right,top:a.top,width:a.width};return b&&(e.left=d.pageX,e.right=d.pageX,e.width=0),c&&(e.top=d.pageY,e.bottom=d.pageY,e.height=0),e}function v(b){var c=a,d=document.documentElement||document.body.parentNode||document.body,e=f(c.pageXOffset)?c.pageXOffset:d.scrollLeft,g=f(c.pageYOffset)?c.pageYOffset:d.scrollTop,h=b.getBoundingClientRect();return e||g?{bottom:h.bottom+g,left:h.left+e,right:h.right+e,top:h.top+g,height:h.height,width:h.width}:h}function w(a){if(a&&0!==a.length){var b=(""+a).toLowerCase();a="true"==b}else a=!1;return a}function x(a,c){return a?b.isString(a)&&c?a:k.get(a)||m.get(a,{cache:!0}):""}function y(){J.isOpen&&E.hide(0)}function z(a){function c(a){if(a.id===d)return!0;var e=b.element(a).parent()[0];return e?e.id===d?!0:c(e):!1}if(J.isOpen&&a.target!==r[0]){var d=J[0].id;c(a.target)||E.hide(0)}}function A(){J.isOpen&&E.hide(0)}var B=d.getDefaults(),C={template:s.nsPopoverTemplate||B.template,theme:s.nsPopoverTheme||B.theme,plain:w(s.nsPopoverPlain||B.plain),trigger:s.nsPopoverTrigger||B.trigger,triggerPrevent:s.nsPopoverTriggerPrevent||B.triggerPrevent,angularEvent:s.nsPopoverAngularEvent||B.angularEvent,scopeEvent:s.nsPopoverScopeEvent||B.scopeEvent,container:s.nsPopoverContainer||B.container,placement:s.nsPopoverPlacement||B.placement,timeout:s.nsPopoverTimeout||B.timeout,hideOnInsideClick:w(s.nsPopoverHideOnInsideClick||B.hideOnInsideClick),hideOnOutsideClick:w(s.nsPopoverHideOnOutsideClick||B.hideOnOutsideClick),hideOnButtonClick:w(s.nsPopoverHideOnButtonClick||B.hideOnButtonClick),mouseRelative:s.nsPopoverMouseRelative,popupDelay:s.nsPopoverPopupDelay||B.popupDelay,group:s.nsPopoverGroup};C.mouseRelative&&(C.mouseRelativeX=-1!==C.mouseRelative.indexOf("x"),C.mouseRelativeY=-1!==C.mouseRelative.indexOf("y"));var D={id_:c,display:function(a,b){p(s.nsPopover)(q)!==!1&&(j.cancel(D.id_),f(a)||(a=0),C.group&&i.$broadcast("ns:popover:hide",C.group),D.id_=j(function(){J.isOpen=!0,J.css("display","block");var a=v(r[0]);C.mouseRelative&&(a=u(a,C.mouseRelativeX,C.mouseRelativeY,b)),t(J,H,I,a,G),C.hideOnInsideClick&&J.on("click",y),C.hideOnOutsideClick&&o.on("click",z),C.hideOnButtonClick&&r.on("click",A)},1e3*a))},cancel:function(){j.cancel(D.id_)}},E={id_:c,hide:function(a){j.cancel(E.id_),f(a)||(a=1.5),E.id_=j(function(){J.off("click",y),o.off("click",z),r.off("click",A),J.isOpen=!1,D.cancel(),J.css("display","none")},1e3*a)},cancel:function(){j.cancel(E.id_)}},F=o.find(C.container);F.length||(F=o.find("body"));var G,H,I;h+=1;var J=e('<div id="nspopover-'+h+'"></div>');g.push(J);var K=C.placement.match(/^(top|bottom|left|right)$|((top|bottom)\|(center|left|right)+)|((left|right)\|(center|top|bottom)+)/);if(!K)throw new Error('"'+C.placement+'" is not a valid placement or has a invalid combination of placements.');H=K[6]||K[3]||K[1],I=K[7]||K[4]||K[2]||"center",l.when(x(C.template,C.plain)).then(function(a){if(a=b.isString(a)?a:a.data&&b.isString(a.data)?a.data:"",J.html(a),C.theme&&J.addClass(C.theme),J.addClass("ns-popover-"+H+"-placement").addClass("ns-popover-"+I+"-align"),n(J)(q),q.$on("$destroy",function(){J.remove()}),q.hidePopover=function(){E.hide(0)},q.$on("ns:popover:hide",function(a,b){C.group===b&&q.hidePopover()}),J.css("position","absolute").css("display","none"),G=J.find(".triangle"),!G.length)for(var c=J.children(),d=0;d<c.length;++d){var f=e(c[d]);if(f.hasClass("triangle")){G=f;break}}F.append(J)}),C.angularEvent?i.$on(C.angularEvent,function(){E.cancel(),D.display(C.popupDelay)}):C.scopeEvent?q.$on(C.scopeEvent,function(){E.cancel(),D.display(J,C.popupDelay)}):r.on(C.trigger,function(a){!1!==C.triggerPrevent&&a.preventDefault(),E.cancel(),D.display(C.popupDelay,a)}),r.on("mouseout",function(){E.hide(C.timeout)}).on("mouseover",function(){E.cancel()}),J.on("mouseout",function(){E.hide(C.timeout)}).on("mouseover",function(){E.cancel()})}}}])}(window,window.angular);